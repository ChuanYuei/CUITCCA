<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body>
<p>连接状态: <span id="status">未连接</span></p>
<p>回复消息websocket: <span id="message"></span></p>
<p><input type="text" id="inp"></p>
<button id="submit">提交</button>

<p>回复消息: <span id="message1"></span></p>
<p><input type="text" id="inp1"></p>
<button id="submit1">提交</button>
<style>
#chatbox {
  display: inline;
}
</style>
<script>
    const api = "://127.0.0.1:8000/graph/query";
    // const url = "://101.32.45.4:8080/api/graph/query";
    let status = document.getElementById("status");
    let message = document.getElementById("message");
    let inp = document.getElementById("inp");
    let submit = document.getElementById("submit");
    const submitButton = document.getElementById("submit1");
    const inputField = document.getElementById("inp1");
    const messageSpan = document.getElementById("message1");

    submitButton.addEventListener("click", () => {
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    const response = xhr.responseText;
                    displayText(response);
                } else {
                    displayText("请求失败");
                }
            }
        };

        const url = "http"+api
        const query = inputField.value;
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.send(`query=${encodeURIComponent(query)}`);
    });

    function displayText(text) {
        const chatbox = document.createElement("span");
        chatbox.id = "chatbox";
        messageSpan.appendChild(chatbox);

        let i = 0;
        const intervalId = setInterval(() => {
            chatbox.textContent += text[i];
            i++;
            if (i >= text.length) {
                clearInterval(intervalId);
            }
        }, 100);
    }

    let ws = new WebSocket("ws"+api);
    ws.addEventListener("open", (even) => {
        status.innerHTML = "已连接";
    });
    ws.addEventListener("error", (event) => {
        message.innerHTML = "失败"
    });
    ws.addEventListener("close", (event) => {
        message.innerHTML = "已关闭"
    });
    ws.addEventListener("message", (event) => {
        message.innerText += event.data;
    });


    submit.addEventListener("click", (event) => {
        ws.send(inp.value);
        message.innerText = ''
    })

</script>
</body>
</html>